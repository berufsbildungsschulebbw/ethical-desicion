<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zwischen Welten - Ethik-Labor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container { max-width: 1000px; margin: 0 auto; }

        header {
            background: white;
            border-radius: 20px;
            padding: 25px 35px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-left { flex: 1; }
        .header-left h1 { color: #667eea; font-size: 1.8em; margin-bottom: 5px; }
        .header-left p { color: #666; font-size: 0.95em; }

        .back-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover { background: #f0f3ff; }

        .content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 25px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s ease;
        }

        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.5s; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 { color: #333; font-size: 2em; margin-bottom: 15px; }
        .subtitle { color: #666; font-size: 1.1em; line-height: 1.6; margin-bottom: 25px; }

        .persona-card {
            background: linear-gradient(135deg, #f0f3ff 0%, #e8f0fe 100%);
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
        }

        .persona-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .persona-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: white;
            flex-shrink: 0;
        }

        .persona-info h3 { color: #667eea; font-size: 1.5em; margin-bottom: 5px; }
        .persona-info p { color: #666; }

        .persona-details {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .detail-item {
            display: flex;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-item:last-child { border-bottom: none; }
        .detail-label { font-weight: bold; color: #667eea; min-width: 140px; }
        .detail-value { color: #333; flex: 1; }

        .dilemma-box {
            background: #fff8e1;
            border-left: 5px solid #ffa726;
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
        }

        .dilemma-title {
            color: #e65100;
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .dilemma-text {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .conflict-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .conflict-list h4 { color: #e65100; margin-bottom: 10px; }
        .conflict-list ul { padding-left: 20px; }
        .conflict-list li { margin: 8px 0; color: #555; line-height: 1.6; }

        .decision-options {
            display: grid;
            gap: 20px;
            margin: 30px 0;
        }

        .option-card {
            background: #f8f9fa;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .option-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .option-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f3ff 0%, #e8f0fe 100%);
        }

        .option-number {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .option-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
            padding-right: 50px;
        }

        .option-description {
            color: #666;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .frameworks-section {
            margin: 35px 0;
            padding: 25px;
            background: #f0f3ff;
            border-radius: 12px;
        }

        .frameworks-title {
            color: #333;
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .frameworks-subtitle {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .framework-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .framework-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }

        .framework-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .framework-btn.clicked {
            background: #e8f0fe;
            border-color: #4caf50;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn-primary, .btn-secondary {
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn-secondary:hover { background: #f0f3ff; }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s;
        }

        .modal.active { display: flex; align-items: center; justify-content: center; }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 40px;
            position: relative;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2em;
            color: #999;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover { background: #f0f0f0; color: #333; }

        .modal h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .modal-section {
            margin: 20px 0;
        }

        .modal-section h4 {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .modal-section p, .modal-section ul {
            color: #555;
            line-height: 1.8;
            margin: 10px 0;
        }

        .modal-section ul {
            padding-left: 25px;
        }

        .modal-section li {
            margin: 8px 0;
        }

        .highlight-box {
            background: #f0f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .result-card {
            background: linear-gradient(135deg, #f0f3ff 0%, #e8f0fe 100%);
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 35px;
            margin: 25px 0;
            text-align: center;
        }

        .result-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .result-title {
            color: #667eea;
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .result-text {
            color: #555;
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .result-stats {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            header { flex-direction: column; text-align: center; }
            .back-btn { margin-top: 15px; }
            .content { padding: 25px; }
            h2 { font-size: 1.6em; }
            .persona-header { flex-direction: column; text-align: center; }
            .framework-buttons { grid-template-columns: 1fr; }
            .action-buttons { flex-direction: column; }
            .btn-primary, .btn-secondary { width: 100%; }
            .modal-content { padding: 25px; width: 95%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üåç Zwischen Welten</h1>
                <p>Ein ethisches Dilemma aus Z√ºrich</p>
            </div>
            <a href="dashboard.html" class="back-btn">‚Üê Zur√ºck</a>
        </header>

        <div class="content">
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>

            <!-- Step 1: Introduction -->
            <div class="step active" id="step-intro">
                <h2>Willkommen zum Dilemma</h2>
                <p class="subtitle">
                    Jugendliche mit Migrationshintergrund in Z√ºrich navigieren komplexe Spannungsfelder zwischen 
                    elterlichen Erwartungen, wirtschaftlichem Druck und kulturellen Werten. Du wirst gleich eine 
                    authentische Persona zugewiesen bekommen und eine schwierige Entscheidung treffen m√ºssen.
                </p>

                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 25px 0;">
                    <h3 style="color: #333; margin-bottom: 15px;">üìã Was dich erwartet:</h3>
                    <ul style="color: #666; line-height: 2; padding-left: 25px;">
                        <li>Eine realistische Persona mit authentischem Hintergrund</li>
                        <li>Ein existenzielles Dilemma ohne "richtige" Antwort</li>
                        <li>5 verschiedene Entscheidungsoptionen</li>
                        <li>Einblicke in 4 ethische Denkweisen (optional)</li>
                        <li>Feedback zu deiner Entscheidung</li>
                    </ul>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" onclick="nextStep()">Los geht's ‚Üí</button>
                </div>
            </div>

            <!-- Step 2: Persona Assignment -->
            <div class="step" id="step-persona">
                <h2>Deine Persona</h2>
                <p class="subtitle">
                    Du schl√ºpfst in die Rolle einer realen Person aus Z√ºrich. Diese Persona basiert auf 
                    ausf√ºhrlicher Recherche und dokumentierten Erfahrungen.
                </p>

                <div class="persona-card" id="persona-card">
                    <!-- Wird dynamisch gef√ºllt -->
                </div>

                <div class="action-buttons">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Zur√ºck</button>
                    <button class="btn-primary" onclick="nextStep()">Weiter ‚Üí</button>
                </div>
            </div>

            <!-- Step 3: The Dilemma -->
            <div class="step" id="step-dilemma">
                <h2>Das Dilemma</h2>
                
                <div class="dilemma-box" id="dilemma-box">
                    <!-- Wird dynamisch gef√ºllt -->
                </div>

                <div class="action-buttons">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Zur√ºck</button>
                    <button class="btn-primary" onclick="nextStep()">Entscheidung treffen ‚Üí</button>
                </div>
            </div>

            <!-- Step 4: Decision -->
            <div class="step" id="step-decision">
                <h2>Deine Entscheidung</h2>
                <p class="subtitle">
                    W√§hle eine der folgenden Optionen. Es gibt keine "richtige" Antwort ‚Äì jede Wahl hat 
                    Konsequenzen und ethische Implikationen.
                </p>

                <div class="decision-options" id="decision-options">
                    <!-- Wird dynamisch gef√ºllt -->
                </div>

                <div class="frameworks-section">
                    <h3 class="frameworks-title">üí° Ethische Perspektiven (Optional)</h3>
                    <p class="frameworks-subtitle">
                        M√∂chtest du verstehen, wie verschiedene ethische Denkweisen diese Situation bewerten w√ºrden? 
                        Klicke auf ein Framework, um mehr zu erfahren.
                    </p>
                    <div class="framework-buttons">
                        <button class="framework-btn" onclick="showFramework('utilitarismus')">
                            üìä Utilitarismus
                        </button>
                        <button class="framework-btn" onclick="showFramework('kant')">
                            ‚öñÔ∏è Deontologie (Kant)
                        </button>
                        <button class="framework-btn" onclick="showFramework('tugend')">
                            üéØ Tugendethik
                        </button>
                        <button class="framework-btn" onclick="showFramework('kommunitarismus')">
                            ü§ù Kommunitarismus
                        </button>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Zur√ºck</button>
                    <button class="btn-primary" id="submit-btn" onclick="submitDecision()" disabled>
                        Entscheidung best√§tigen
                    </button>
                </div>
            </div>

            <!-- Step 5: Result -->
            <div class="step" id="step-result">
                <div class="result-card">
                    <div class="result-icon">‚úÖ</div>
                    <h2 class="result-title">Entscheidung gespeichert</h2>
                    <p class="result-text" id="result-text">
                        <!-- Wird dynamisch gef√ºllt -->
                    </p>

                    <div class="result-stats" id="result-stats">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 25px 0;">
                    <h3 style="color: #333; margin-bottom: 15px;">üí≠ Reflexion</h3>
                    <p style="color: #666; line-height: 1.8;">
                        Es gibt keine "richtige" Antwort auf dieses Dilemma. Jede Entscheidung hat Kosten und 
                        Konsequenzen. Die St√§rke liegt darin, die verschiedenen Perspektiven zu verstehen und 
                        eine informierte Wahl zu treffen, w√§hrend man sich der Trade-offs bewusst ist.
                    </p>
                </div>

                <div class="action-buttons">
                    <button class="btn-secondary" onclick="window.location.href='dashboard.html'">
                        ‚Üê Zur√ºck zum Dashboard
                    </button>
                    <button class="btn-primary" onclick="window.location.href='statistics.html'">
                        Statistiken ansehen üìä
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Framework Modals -->
    <div class="modal" id="modal-utilitarismus">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('utilitarismus')">&times;</span>
            <h3>üìä Utilitarismus: Gr√∂√ütes Gut f√ºr gr√∂√üte Zahl</h3>
            
            <div class="modal-section">
                <h4>Was ist Utilitarismus?</h4>
                <p>
                    Utilitarismus fragt: "Welche Wahl produziert das meiste Gute f√ºr die meisten Menschen?" 
                    Entwickelt von Jeremy Bentham und John Stuart Mill, beurteilt dieser Ansatz Handlungen 
                    durch ihre Konsequenzen, nicht durch Regeln oder Intentionen.
                </p>
            </div>

            <div class="modal-section">
                <h4>Anwendung auf dieses Dilemma</h4>
                <p>
                    Ein Utilitarist w√ºrde versuchen, das Gesamtwohlbefinden zu berechnen: Wie viel Leiden 
                    verursacht gegenw√§rtiger Hunger versus zuk√ºnftige Nahrungsknappheit? Wie viele Menschen 
                    profitieren von sofortigem Einkommen versus langfristiger Bildung?
                </p>
                <div class="highlight-box">
                    <strong>Zentrale Frage:</strong> Welche Option maximiert das Wohlergehen aller Beteiligten 
                    ‚Äì Familie, Individuum, Gemeinschaft ‚Äì √ºber die Zeit hinweg?
                </div>
            </div>

            <div class="modal-section">
                <h4>‚úÖ St√§rken</h4>
                <ul>
                    <li>Ber√ºcksichtigt alle Betroffenen ‚Äì Familie, Individuum, zuk√ºnftige Generationen</li>
                    <li>Fokussiert auf echten Schaden (Hunger, Armut) statt abstrakten Prinzipien</li>
                    <li>Flexibel und pragmatisch basierend auf tats√§chlichen Bedingungen</li>
                </ul>
            </div>

            <div class="modal-section">
                <h4>‚ö†Ô∏è Grenzen im kulturellen Kontext</h4>
                <ul>
                    <li>K√§mpft damit, kulturelle Identit√§t und Familienehre zu "messen"</li>
                    <li>K√∂nnte traditionelle Werte unterbewertet, die f√ºr Gemeinschaften zentral sind</li>
                    <li>Behandelt komplexe Beziehungen als simple Berechnungen</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-kant">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('kant')">&times;</span>
            <h3>‚öñÔ∏è Deontologie: Moralischen Pflichten folgen</h3>
            
            <div class="modal-section">
                <h4>Was ist Deontologie?</h4>
                <p>
                    Deontologie, entwickelt von Immanuel Kant, beurteilt Handlungen danach, ob sie moralischen 
                    Pflichten und universellen Prinzipien folgen, nicht nach ihren Ergebnissen. Der "kategorische 
                    Imperativ" besagt: Handle nur nach Regeln, von denen du wollen k√∂nntest, dass alle ihnen folgen.
                </p>
            </div>

            <div class="modal-section">
                <h4>Anwendung auf dieses Dilemma</h4>
                <p>
                    Deontologie identifiziert multiple Pflichten: zur hungrigen Familie, zu eigenen Talenten und 
                    Potenzial, zu kulturellen Traditionen, zu zuk√ºnftigen Generationen. Diese Pflichten k√∂nnen 
                    konfligieren.
                </p>
                <div class="highlight-box">
                    <strong>Zentrale Frage:</strong> Welche moralischen Verpflichtungen habe ich, und wie 
                    priorisiere ich sie, wenn sie in Konflikt stehen?
                </div>
            </div>

            <div class="modal-section">
                <h4>‚úÖ St√§rken</h4>
                <ul>
                    <li>Respektiert Rechte aller Parteien ‚Äì Eltern, Geschwister, eigene Zukunft</li>
                    <li>Erkennt kulturelle Erwartungen als ernsthafte moralische Verpflichtungen</li>
                    <li>Bietet klare Orientierung auch bei unsicheren Ergebnissen</li>
                </ul>
            </div>

            <div class="modal-section">
                <h4>‚ö†Ô∏è Grenzen im kulturellen Kontext</h4>
                <ul>
                    <li>Kann zu starr sein in Krisensituationen (extremer Hunger)</li>
                    <li>K√§mpft, wenn Pflichten konfligieren ‚Äì Familie vs. Selbstverwirklichung</li>
                    <li>Kants westliche Rationalit√§t passt nicht immer zu relationaler Ethik</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-tugend">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('tugend')">&times;</span>
            <h3>üéØ Tugendethik: Was w√ºrde die gute Person tun?</h3>
            
            <div class="modal-section">
                <h4>Was ist Tugendethik?</h4>
                <p>
                    Tugendethik, von Aristoteles begr√ºndet, fragt nicht "Was ist die Regel?" oder "Was sind die 
                    Konsequenzen?", sondern "Was f√ºr eine Person sollte ich sein?" Sie fokussiert auf die 
                    Entwicklung exzellenter Charaktereigenschaften wie Weisheit, Mut, Gerechtigkeit und M√§√üigung.
                </p>
            </div>

            <div class="modal-section">
                <h4>Anwendung auf dieses Dilemma</h4>
                <p>
                    Tugendethik untersucht: Welchen Charakter w√ºrde die gute Tochter/der gute Sohn entwickeln? 
                    Relevante Tugenden sind praktische Weisheit (kluge Entscheidungen), Mut (gegen Druck standhaft 
                    bleiben), Gerechtigkeit (fair zu allen Beteiligten), Respekt und Integrit√§t.
                </p>
                <div class="highlight-box">
                    <strong>Zentrale Frage:</strong> Welche Wahl demonstriert die Tugenden, die ich kultivieren 
                    m√∂chte, und hilft mir, ein gutes Leben im Einklang mit meinen Werten zu f√ºhren?
                </div>
            </div>

            <div class="modal-section">
                <h4>‚úÖ St√§rken</h4>
                <ul>
                    <li>Holistisch ‚Äì ber√ºcksichtigt die ganze Person und ihre Beziehungen</li>
                    <li>Sch√§tzt praktische Weisheit und ortsbasiertes Wissen</li>
                    <li>Passt gut zu kultureller Betonung auf Charakterentwicklung und Mentorschaft</li>
                    <li>Langfristige Perspektive ‚Äì Gedeihen erfordert nachhaltige Beziehungen</li>
                </ul>
            </div>

            <div class="modal-section">
                <h4>‚ö†Ô∏è Grenzen</h4>
                <ul>
                    <li>Manchmal vage √ºber spezifische Handlungen in konkreten Situationen</li>
                    <li>Kulturelle Variation in Tugenden ‚Äì was ist "gut" in verschiedenen Kulturen?</li>
                    <li>Weniger hilfreich in akuten Krisen mit Zeitdruck</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-kommunitarismus">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('kommunitarismus')">&times;</span>
            <h3>ü§ù Kommunitarismus: Gemeinschaftswerte und Beziehungen</h3>
            
            <div class="modal-section">
                <h4>Was ist Kommunitarismus?</h4>
                <p>
                    Kommunitarismus, entwickelt von Alasdair MacIntyre, Michael Sandel und Charles Taylor, 
                    argumentiert, dass Individuen fundamental von ihren Gemeinschaften, Traditionen und 
                    Beziehungen geformt sind. Unsere Identit√§ten entstehen aus den Gemeinschaften, denen 
                    wir angeh√∂ren, nicht aus abstrakten universellen Prinzipien.
                </p>
            </div>

            <div class="modal-section">
                <h4>Anwendung auf dieses Dilemma</h4>
                <p>
                    Kommunitarismus betont: Du bist kein isoliertes Individuum, sondern eingebettet in Familie, 
                    Herkunftskultur, Schweizer Gesellschaft, und Migrantencommunity. Deine Rolle bringt 
                    Verantwortungen mit sich, die durch Gemeinschaftstraditionen definiert sind.
                </p>
                <div class="highlight-box">
                    <strong>Zentrale Frage:</strong> Was lehren uns unsere geteilten Traditionen? Wie erhalten 
                    wir Beziehungen mit allen Gemeinschaften, denen wir angeh√∂ren?
                </div>
            </div>

            <div class="modal-section">
                <h4>‚úÖ St√§rken</h4>
                <ul>
                    <li>Ehrt Traditionen als Weisheit, nicht als Aberglaube</li>
                    <li>Passt zu kulturellen gemeinschaftlichen Werten</li>
                    <li>Erkennt, wir sind fundamental relational, nicht isoliert</li>
                    <li>Sch√§tzt ortsbasiertes Wissen √ºber abstrakte Prinzipien</li>
                </ul>
            </div>

            <div class="modal-section">
                <h4>‚ö†Ô∏è Grenzen</h4>
                <ul>
                    <li>Kann n√∂tiger Anpassung widerstehen (z.B. an neue Schweizer Realit√§ten)</li>
                    <li>Gemeinschaften k√∂nnen auch unterdr√ºckend sein</li>
                    <li>Wessen Stimme definiert "Gemeinschaftswerte"?</li>
                    <li>Wie Konflikte zwischen verschiedenen Gemeinschaften aufl√∂sen?</li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module">
        import { getCurrentUser, isUserLoggedIn, markDilemmaCompleted } from './user.js';
        import { db } from './config.js';
        import { collection, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Check if user is logged in
        if (!isUserLoggedIn()) {
            window.location.href = 'index.html';
        }

        const user = getCurrentUser();

        // Personas Data
        const personas = [
            {
                id: 'elif',
                name: 'Elif',
                age: 16,
                background: 'T√ºrkisch-kurdisch',
                location: 'Z√ºrich-Schwamendingen',
                emoji: 'üëß',
                details: {
                    'Situation': 'Gute Noten in Sekundarschule A, k√∂nnte Kurzgymnasium schaffen',
                    'Traum': 'Medizin studieren',
                    'Familie': 'Vater Bauarbeiter (CHF 4\'500/Mt), Mutter Reinigung (CHF 2\'000/Mt), 2 Geschwister',
                    'Wohnsituation': '3.5-Zimmer in Schwamendingen (CHF 2\'800/Mt + CHF 2\'200/Mt Krankenversicherung)',
                    'Besonderheit': 'Konservative Familie, erweiterte Familie √ºbt Druck aus'
                },
                dilemma: {
                    title: 'üéì Gymnasium oder schnell Geld verdienen?',
                    situation: 'Deine Noten sind gut genug f√ºrs Gymnasium. Mit Gl√ºck und harter Arbeit k√∂nntest du in 4 Jahren Matura machen und dann Medizin studieren ‚Äì dein Traum seit Jahren. Aber dein Vater besteht auf eine KV-Lehre.',
                    conflict: [
                        'KV-Lehre: CHF 650/Mt im ersten Jahr, nach 4 Jahren CHF 5\'367/Mt',
                        'Gymnasium: 4 Jahre ohne Einkommen, dann 6 Jahre Studium',
                        'Familie braucht dringend finanzielle Unterst√ºtzung',
                        'Konservative Familie: "Ein M√§dchen braucht keine Uni"',
                        'Erweiterte Familie und Community √ºben Druck aus',
                        'Du f√ºhlst massive Schuldgef√ºhle: "Meine Eltern haben so viel geopfert"'
                    ]
                },
                options: [
                    {
                        id: 'family',
                        title: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie & Tradition',
                        description: 'Ich mache die KV-Lehre wie meine Eltern es wollen. Familie geht vor, ich kann sie jetzt nicht im Stich lassen.'
                    },
                    {
                        id: 'compromise',
                        title: '‚öñÔ∏è Kompromiss',
                        description: 'KV mit Berufsmaturit√§t ‚Äì dann sp√§ter Fachhochschule. Ich verdiene Geld UND kann studieren, nur anders.'
                    },
                    {
                        id: 'career',
                        title: 'üéØ Karriere & Unabh√§ngigkeit',
                        description: 'Ich k√§mpfe f√ºrs Gymnasium. Es wird hart, aber ich hole mir Unterst√ºtzung von Mentoring-Programmen.'
                    },
                    {
                        id: 'delay',
                        title: '‚è∞ Zeit f√ºr Entscheidung',
                        description: 'Ich mache erstmal ein Zwischenjahr mit Praktika und Sprachkursen, um herauszufinden, was ich wirklich will.'
                    },
                    {
                        id: 'community',
                        title: 'ü§ù Gemeinschaftsl√∂sung',
                        description: 'Ich suche das Gespr√§ch mit vertrauensw√ºrdigen Community-Mitgliedern, die beide Welten kennen.'
                    }
                ]
            },
            {
                id: 'luan',
                name: 'Luan',
                age: 18,
                background: 'Kosovo-albanisch (2. Generation)',
                location: 'Z√ºrich-Altstetten',
                emoji: 'üë¶',
                details: {
                    'Situation': 'Polymechaniker-Lehrstelle bei renommiertem Betrieb angeboten',
                    'Talent': 'Handwerklich sehr begabt, liebt praktische Arbeit',
                    'Familie': 'Eltern betreiben serbisches Restaurant (Kreis 5), arbeiten 6 Tage/Woche',
                    'Schulniveau': 'Sekundarschule B, Gymnasium w√§re sehr schwer',
                    'Besonderheit': 'Starker Druck wegen Familienehre und Community-Status'
                },
                dilemma: {
                    title: 'üîß Handwerk oder akademischer Prestige?',
                    situation: 'Du hast ein Angebot f√ºr eine Polymechaniker-Lehre bei einem top Betrieb. Nach 4 Jahren w√ºrdest du CHF 5\'500+/Mt verdienen. Aber deine Eltern bestehen: "Du MUSST aufs Gymnasium, sonst bist du ein Niemand."',
                    conflict: [
                        'Du bist handwerklich begabt und liebst praktische Arbeit',
                        'Gymnasium w√§re extrem schwer f√ºr dich (Sekundarschule B-Niveau)',
                        'In der Herkunftskultur: "Handwerker = Versager"',
                        'Statusangst: Was denkt die erweiterte Familie?',
                        '√Ñlterer Bruder macht KV ‚Äì du solltest "h√∂her" hinaus',
                        'Du leidest unter dem Gef√ºhl, eine Entt√§uschung zu sein'
                    ]
                },
                options: [
                    {
                        id: 'family',
                        title: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie & Tradition',
                        description: 'Ich versuche das Gymnasium, auch wenn es hart wird. Die Familienehre ist wichtiger als meine eigenen W√ºnsche.'
                    },
                    {
                        id: 'compromise',
                        title: '‚öñÔ∏è Kompromiss',
                        description: 'Polymechaniker-Lehre + Berufsmaturit√§t + dann FH Maschinenbau-Ingenieur. Praktisch UND prestigetr√§chtig!'
                    },
                    {
                        id: 'career',
                        title: 'üéØ Karriere & Unabh√§ngigkeit',
                        description: 'Ich mache die Polymechaniker-Lehre. Das ist mein Talent, mein Weg. Meine Familie wird das akzeptieren m√ºssen.'
                    },
                    {
                        id: 'delay',
                        title: '‚è∞ Zeit f√ºr Entscheidung',
                        description: 'Ich verschiebe um ein Jahr, arbeite im Restaurant mit und beweise erstmal, dass ich reif bin f√ºr gro√üe Entscheidungen.'
                    },
                    {
                        id: 'community',
                        title: 'ü§ù Gemeinschaftsl√∂sung',
                        description: 'Ich organisiere ein Treffen mit erfolgreichen Handwerkern aus unserer Community, die meinen Eltern zeigen, dass Berufsbildung wertvoll ist.'
                    }
                ]
            },
            {
                id: 'mariana',
                name: 'Mariana',
                age: 17,
                background: 'Portugiesisch',
                location: 'Z√ºrich-Oerlikon',
                emoji: 'üë©',
                details: {
                    'Situation': 'Sekundarschule A abgeschlossen, starkes Interesse an Informatik',
                    'Erfahrung': 'Hat Schnupperlehre bei Software-Firma gemacht',
                    'Familie': 'Vater Maurer, Mutter Verk√§uferin, traditionelle Werte',
                    'Geschlecht': 'Einziges M√§dchen unter 12 m√§nnlichen Lehrlingen in Schnupperlehre',
                    'Besonderheit': 'Geschlechternormen vs. hohes Verdienstpotenzial'
                },
                dilemma: {
                    title: 'üíª IT-Pionierin oder traditioneller Frauenberuf?',
                    situation: 'Nach der Schnupperlehre bei einer Software-Firma bist du begeistert von Informatik. Nach abgeschlossener Lehre w√ºrdest du CHF 6\'370/Mt verdienen ‚Äì das h√∂chste Durchschnittsgehalt. Aber deine Mutter schl√§gt Detailhandel oder Pflege vor: "Das sind Frauenberufe, da f√ºhlst du dich wohl."',
                    conflict: [
                        'IT: CHF 6\'370/Mt nach Abschluss, spannende Karriere',
                        'Detailhandel: Unter CHF 5\'000/Mt (CHF 1\'370+ Unterschied!)',
                        'Vater skeptisch: "IT ist f√ºr M√§nner, zu technisch"',
                        'In Schnupperlehre warst du das einzige M√§dchen',
                        'Wenige weibliche Vorbilder in technischen Berufen',
                        'Diese Geschlechternorm kostet dich √ºber dein Leben Hunderttausende CHF'
                    ]
                },
                options: [
                    {
                        id: 'family',
                        title: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie & Tradition',
                        description: 'Ich mache Detailhandel oder Pflege. Die Familie hat recht ‚Äì da passe ich besser hin als Frau.'
                    },
                    {
                        id: 'compromise',
                        title: '‚öñÔ∏è Kompromiss',
                        description: 'KV mit Schwerpunkt Informatik ‚Äì dann kann ich sp√§ter trotzdem in IT quereinsteigen, ohne so sehr anzuecken.'
                    },
                    {
                        id: 'career',
                        title: 'üéØ Karriere & Unabh√§ngigkeit',
                        description: 'Informatik-Lehre! Ich hole mir Mentoring-Unterst√ºtzung und werde Vorbild f√ºr andere M√§dchen.'
                    },
                    {
                        id: 'delay',
                        title: '‚è∞ Zeit f√ºr Entscheidung',
                        description: 'Ich mache ein technisches Br√ºckenangebot, um meine F√§higkeiten zu beweisen und mehr Sicherheit zu gewinnen.'
                    },
                    {
                        id: 'community',
                        title: 'ü§ù Gemeinschaftsl√∂sung',
                        description: 'Ich suche weibliche IT-Profis aus der portugiesischen Community, die mit meinen Eltern sprechen.'
                    }
                ]
            },
            {
                id: 'amanuel',
                name: 'Amanuel',
                age: 20,
                background: 'Eritrea (Fl√ºchtling)',
                location: 'Asylunterkunft Z√ºrich-H√∂ngg',
                emoji: 'üßë',
                details: {
                    'Situation': 'War Lehrer in Eritrea, Diplom nicht anerkannt in der Schweiz',
                    'Status': 'F-Bewilligung (vorl√§ufig aufgenommen), traumatische Flucht',
                    'Familie': 'Frau und Kind in Eritrea (Familiennachzug beantragt)',
                    'Angebot': 'INVOL-Programm bietet G√§rtner EBA (2 Jahre)',
                    'Besonderheit': 'Beruflicher "Abstieg" vom respektierten Lehrer zu manueller Arbeit'
                },
                dilemma: {
                    title: 'üå± Pragmatismus oder Aspirationen?',
                    situation: 'In Eritrea warst du Lehrer ‚Äì ein hochrespektierter Beruf. Hier ist dein Diplom nicht anerkannt. Das INVOL-Programm bietet dir eine G√§rtner-Lehre (EBA, 2 Jahre) an der UZH. Schnelle finanzielle Unabh√§ngigkeit, aber es f√ºhlt sich an wie ein Abstieg.',
                    conflict: [
                        'Traum: Wieder als Lehrer arbeiten ‚Üí Jahre bis zur Anerkennung, hohe H√ºrden',
                        'G√§rtner EBA: 2 Jahre, dann finanzielle Unabh√§ngigkeit',
                        'In Eritrea: Lehrer = Prestige, G√§rtnerei = Subsistenz',
                        'F-Bewilligung: Zugang zu Uni sehr kompliziert und teuer',
                        'Frau und Kind warten in Eritrea ‚Äì du brauchst Einkommen',
                        'Schweizer System: Fokus auf "schnelle Besch√§ftigung", nicht Qualifikation'
                    ]
                },
                options: [
                    {
                        id: 'family',
                        title: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie & Tradition',
                        description: 'Ich warte und k√§mpfe weiter f√ºr die Anerkennung als Lehrer. Meine Qualifikation ist zu wertvoll, um aufzugeben.'
                    },
                    {
                        id: 'compromise',
                        title: '‚öñÔ∏è Kompromiss',
                        description: 'G√§rtner EBA + Abendschule f√ºr Qualifikationen + sp√§ter Quereinstieg in Sozialp√§dagogik (Arbeit mit Jugendlichen).'
                    },
                    {
                        id: 'career',
                        title: 'üéØ Karriere & Unabh√§ngigkeit',
                        description: 'Ich mache Fachmann Betreuung (Sozialbereich) ‚Äì n√§her an meinen Interessen als G√§rtnerei.'
                    },
                    {
                        id: 'delay',
                        title: '‚è∞ Zeit f√ºr Entscheidung',
                        description: 'Ich arbeite tempor√§r ungelernt und spare Geld, w√§hrend ich parallel an Diplomanerkennung arbeite.'
                    },
                    {
                        id: 'community',
                        title: 'ü§ù Gemeinschaftsl√∂sung',
                        description: 'Ich kontaktiere eritreische Lehrer-Community in der Schweiz und NGOs, die bei Qualifikationsanerkennung helfen.'
                    }
                ]
            },
            {
                id: 'mehmet',
                name: 'Mehmet',
                age: 16,
                background: 'T√ºrkei (2. Generation, in Z√ºrich geboren)',
                location: 'Z√ºrich-Schwamendingen',
                emoji: 'üë¶',
                details: {
                    'Situation': 'Zimmermann-Lehrstelle in Aussicht, liebt Arbeit mit Holz',
                    'Familie': 'Eltern kamen als ungelernte Arbeiter, schufteten 20+ Jahre',
                    'Schulniveau': 'Sekundarschule B, Gymnasium unrealistisch',
                    'Opfernarrativ': 'Eltern: "Wir haben Heimat verlassen und geschuftet ‚Äì damit DU studieren kannst"',
                    'Besonderheit': 'Starkes Opfernarrativ der Eltern belastet emotional'
                },
                dilemma: {
                    title: 'ü™µ Handwerker oder Arzt werden?',
                    situation: 'Du liebst Arbeit mit Holz und hast eine Zimmermann-Lehrstelle sicher (nach Jahren CHF 5\'400/Mt). Aber deine Eltern haben 20+ Jahre geschuftet als K√ºchenhilfe und Reinigungskraft: "Wir haben alles geopfert, damit DU Arzt oder Anwalt wirst." Das Gymnasium w√§re extrem schwer f√ºr dich.',
                    conflict: [
                        'Zimmermann: K√∂rperliche Arbeit die du liebst, gutes Gehalt',
                        'Eltern sehen Handwerk als "das, was wir hinter uns lassen wollten"',
                        'Identit√§tsspannung: Schweizer Werte vs. Familienerwartungen',
                        'Opfernarrativ: "Wir haben unser Leben geopfert f√ºr dich"',
                        'Gymnasium w√§re √úberforderung (Sekundarschule B)',
                        'Du f√ºhlst: "Ich entt√§usche ihr ganzes Leben"'
                    ]
                },
                options: [
                    {
                        id: 'family',
                        title: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie & Tradition',
                        description: 'Ich versuche das Gymnasium. Ich schulde es meinen Eltern nach ihren Opfern, auch wenn es mich √ºberfordert.'
                    },
                    {
                        id: 'compromise',
                        title: '‚öñÔ∏è Kompromiss',
                        description: 'Wirtschaftsgymnasium (4 Jahre, einfacher) + Studium Wirtschaft ‚Äì f√ºr Familie akzeptabel, f√ºr mich tolerierbar.'
                    },
                    {
                        id: 'career',
                        title: 'üéØ Karriere & Unabh√§ngigkeit',
                        description: 'Zimmermann-Lehre. Ich respektiere ihre Opfer, aber ich muss meinen eigenen Weg gehen, nicht ihren Traum leben.'
                    },
                    {
                        id: 'delay',
                        title: '‚è∞ Zeit f√ºr Entscheidung',
                        description: 'Ich mache ein Praktikumsjahr in verschiedenen Bereichen, um Eltern zu zeigen, was mir wirklich liegt.'
                    },
                    {
                        id: 'community',
                        title: 'ü§ù Gemeinschaftsl√∂sung',
                        description: 'Ich suche das Gespr√§ch mit einem respektierten Community-Mitglied, das zwischen mir und meinen Eltern vermitteln kann.'
                    }
                ]
            }
        ];

        // State
        let currentStep = 0;
        let selectedPersona = null;
        let selectedDecision = null;
        let frameworksClicked = new Set();
        let startTime = Date.now();

        // Initialize
        window.onload = function() {
            selectedPersona = personas[Math.floor(Math.random() * personas.length)];
            updateProgress();
        };

        // Navigation
        window.nextStep = function() {
            const steps = document.querySelectorAll('.step');
            steps[currentStep].classList.remove('active');
            currentStep++;
            steps[currentStep].classList.add('active');
            updateProgress();
            
            if (currentStep === 1) {
                displayPersona();
            } else if (currentStep === 2) {
                displayDilemma();
            } else if (currentStep === 3) {
                displayDecisionOptions();
            }
            
            window.scrollTo(0, 0);
        };

        window.prevStep = function() {
            const steps = document.querySelectorAll('.step');
            steps[currentStep].classList.remove('active');
            currentStep--;
            steps[currentStep].classList.add('active');
            updateProgress();
            window.scrollTo(0, 0);
        };

        function updateProgress() {
            const progress = ((currentStep) / 4) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function displayPersona() {
            const card = document.getElementById('persona-card');
            const p = selectedPersona;
            
            let detailsHtml = '';
            for (const [key, value] of Object.entries(p.details)) {
                detailsHtml += `
                    <div class="detail-item">
                        <span class="detail-label">${key}:</span>
                        <span class="detail-value">${value}</span>
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="persona-header">
                    <div class="persona-avatar">${p.emoji}</div>
                    <div class="persona-info">
                        <h3>${p.name}, ${p.age} Jahre</h3>
                        <p><strong>${p.background}</strong> ‚Ä¢ ${p.location}</p>
                    </div>
                </div>
                <div class="persona-details">
                    ${detailsHtml}
                </div>
            `;
        }

        function displayDilemma() {
            const box = document.getElementById('dilemma-box');
            const d = selectedPersona.dilemma;
            
            let conflictHtml = '';
            d.conflict.forEach(item => {
                conflictHtml += `<li>${item}</li>`;
            });
            
            box.innerHTML = `
                <div class="dilemma-title">${d.title}</div>
                <div class="dilemma-text">${d.situation}</div>
                <div class="conflict-list">
                    <h4>üí• Das Spannungsfeld:</h4>
                    <ul>${conflictHtml}</ul>
                </div>
            `;
        }

        function displayDecisionOptions() {
            const container = document.getElementById('decision-options');
            container.innerHTML = '';
            
            selectedPersona.options.forEach((option, index) => {
                const card = document.createElement('div');
                card.className = 'option-card';
                card.onclick = () => selectOption(option.id, card);
                
                card.innerHTML = `
                    <div class="option-number">${index + 1}</div>
                    <div class="option-title">${option.title}</div>
                    <div class="option-description">${option.description}</div>
                `;
                
                container.appendChild(card);
            });
        }

        function selectOption(optionId, cardElement) {
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            cardElement.classList.add('selected');
            selectedDecision = optionId;
            document.getElementById('submit-btn').disabled = false;
        }

        window.showFramework = function(framework) {
            frameworksClicked.add(framework);
            document.getElementById(`modal-${framework}`).classList.add('active');
            
            // Mark button as clicked
            event.target.classList.add('clicked');
        };

        window.closeModal = function(framework) {
            document.getElementById(`modal-${framework}`).classList.remove('active');
        };

        // Close modal on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        };

        window.submitDecision = async function() {
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.textContent = 'Speichere...';
            
            const timeSpent = Math.round((Date.now() - startTime) / 1000);
            
            const decisionData = {
                username: user.username,
                dilemmaId: 'migration',
                persona: selectedPersona.id,
                decision: selectedDecision,
                timeSpent: timeSpent,
                frameworksClicked: Array.from(frameworksClicked),
                timestamp: new Date().toISOString()
            };
            
            try {
                if (db) {
                    await addDoc(collection(db, 'decisions'), decisionData);
                    console.log('‚úÖ Decision saved:', decisionData);
                }
                
                await markDilemmaCompleted('migration');
                
                displayResult(timeSpent);
                nextStep();
                
            } catch (error) {
                console.error('‚ùå Error saving decision:', error);
                alert('Fehler beim Speichern. Bitte versuche es erneut.');
                btn.disabled = false;
                btn.textContent = 'Entscheidung best√§tigen';
            }
        };

        function displayResult(timeSpent) {
            const decisionLabels = {
                'family': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie & Tradition',
                'compromise': '‚öñÔ∏è Kompromiss',
                'career': 'üéØ Karriere & Unabh√§ngigkeit',
                'delay': '‚è∞ Zeit f√ºr Entscheidung',
                'community': 'ü§ù Gemeinschaftsl√∂sung'
            };
            
            const resultText = document.getElementById('result-text');
            resultText.innerHTML = `
                Du hast dich f√ºr <strong>${decisionLabels[selectedDecision]}</strong> entschieden.
                <br><br>
                Diese Wahl spiegelt deine Werte und Priorit√§ten wider. Es gibt keine objektiv "richtige" 
                Antwort ‚Äì jede Option hat ihre eigenen Konsequenzen, Vorteile und Herausforderungen.
            `;
            
            const statsHtml = `
                <div class="stat-item">
                    <div class="stat-number">${Math.floor(timeSpent / 60)}:${(timeSpent % 60).toString().padStart(2, '0')}</div>
                    <div class="stat-label">Entscheidungszeit</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${frameworksClicked.size}</div>
                    <div class="stat-label">Frameworks gelesen</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${selectedPersona.name}</div>
                    <div class="stat-label">Deine Persona</div>
                </div>
            `;
            
            document.getElementById('result-stats').innerHTML = statsHtml;
        }
    </script>
</body>
</html>
