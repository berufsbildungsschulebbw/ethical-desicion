<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zwischen Welten - Ethik-Labor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container { max-width: 1000px; margin: 0 auto; }

        .back-link {
            display: inline-block;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .back-link:hover { background: rgba(255,255,255,0.3); }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .persona-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px 20px 0 0;
            margin: -40px -40px 30px -40px;
        }

        .persona-avatar {
            font-size: 5em;
            margin-bottom: 10px;
        }

        .persona-name {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .persona-profession {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .persona-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .detail-item {
            padding: 15px;
            background: white;
            border-radius: 10px;
        }

        .detail-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .detail-value {
            color: #333;
            line-height: 1.5;
        }

        h2 {
            color: #333;
            margin: 30px 0 15px 0;
            font-size: 1.8em;
        }

        .dilemma-text {
            color: #555;
            line-height: 1.8;
            font-size: 1.1em;
            margin: 20px 0;
        }

        .highlight-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
        }

        .highlight-box strong {
            color: #856404;
        }

        .options-container {
            margin: 40px 0;
        }

        .option-card {
            background: #f8f9fa;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .option-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f3ff 0%, #e8f0fe 100%);
        }

        .option-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .option-icon {
            font-size: 2.5em;
        }

        .option-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .option-description {
            color: #666;
            line-height: 1.6;
            margin-left: 60px;
        }

        .frameworks-section {
            margin: 40px 0;
            padding: 30px;
            background: #f0f3ff;
            border-radius: 15px;
        }

        .frameworks-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .frameworks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .framework-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
        }

        .framework-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .framework-btn.clicked {
            background: #667eea;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal-content {
            background: white;
            max-width: 800px;
            margin: 50px auto;
            border-radius: 20px;
            padding: 40px;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .modal-close:hover { color: #333; }

        .modal h3 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .modal-text {
            color: #555;
            line-height: 1.8;
            font-size: 1.05em;
        }

        .modal-section {
            margin: 25px 0;
        }

        .modal-section h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 30px;
            font-weight: bold;
            display: block;
            width: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .timer-box {
            background: #e8f0fe;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        .timer-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .timer-value {
            color: #667eea;
            font-size: 2em;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .persona-details { grid-template-columns: 1fr; }
            .frameworks-grid { grid-template-columns: 1fr; }
            .option-description { margin-left: 0; margin-top: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="dashboard.html" class="back-link">‚Üê Zur√ºck zum Dashboard</a>

        <div class="card" id="main-content">
            <!-- Persona Header -->
            <div class="persona-header">
                <div class="persona-avatar" id="persona-avatar">üë§</div>
                <div class="persona-name" id="persona-name">Lade...</div>
                <div class="persona-profession" id="persona-profession"></div>
            </div>

            <!-- Persona Details -->
            <div class="persona-details" id="persona-details"></div>

            <!-- Timer -->
            <div class="timer-box">
                <div class="timer-label">Entscheidungszeit</div>
                <div class="timer-value" id="timer">0:00</div>
            </div>

            <!-- Dilemma -->
            <h2>üåç Deine Situation</h2>
            <div class="dilemma-text" id="dilemma-text">
                <!-- Wird dynamisch gef√ºllt -->
            </div>

            <div class="highlight-box">
                <strong>Die zentrale Frage:</strong> Was ist dir wichtiger - die Tradition und Familie oder deine pers√∂nliche Karriere und Unabh√§ngigkeit?
            </div>

            <!-- Ethical Frameworks Info -->
            <div class="frameworks-section">
                <div class="frameworks-title">üìö Ethische Perspektiven</div>
                <p style="text-align: center; color: #666; margin-bottom: 20px;">
                    Bevor du entscheidest: Wie w√ºrden verschiedene ethische Theorien diese Situation bewerten?
                </p>
                <div class="frameworks-grid">
                    <button class="framework-btn" onclick="showFramework('utilitarismus')">
                        ‚öñÔ∏è Utilitarismus
                    </button>
                    <button class="framework-btn" onclick="showFramework('kant')">
                        üìú Deontologie (Kant)
                    </button>
                    <button class="framework-btn" onclick="showFramework('tugend')">
                        üéØ Tugendethik
                    </button>
                    <button class="framework-btn" onclick="showFramework('kommunitarismus')">
                        ü§ù Kommunitarismus
                    </button>
                </div>
            </div>

            <!-- Options -->
            <h2>üí≠ Deine Entscheidung</h2>
            <p style="color: #666; margin-bottom: 20px;">W√§hle eine Option, die deiner √úberzeugung am n√§chsten kommt:</p>

            <div class="options-container" id="options-container">
                <!-- Options werden dynamisch generiert -->
            </div>

            <button class="submit-btn" id="submit-btn" disabled onclick="submitDecision()">
                Entscheidung best√§tigen
            </button>
        </div>
    </div>

    <!-- Framework Modal -->
    <div class="modal" id="framework-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script type="module">
        import { db } from './config.js';
        import { getCurrentUser, markDilemmaCompleted } from './user.js';
        import { collection, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // App State
        const appState = {
            user: getCurrentUser(),
            persona: null,
            selectedOption: null,
            startTime: Date.now(),
            frameworksClicked: [],
            timerInterval: null
        };

        // Personas Definition
        const personas = [
            {
                id: 'leyla',
                name: 'Leyla',
                age: 26,
                gender: 'weiblich',
                avatar: 'üë©üèª',
                profession: 'Architektin',
                background: 'Geboren in Deutschland, Eltern aus der T√ºrkei',
                education: 'Master in Architektur, TU Berlin',
                jobOffer: 'Renommiertes Architekturb√ºro in Hamburg',
                family: 'Vater (krank), Mutter, j√ºngere Schwester (Medizinstudentin)',
                personality: 'Kreativ, pflichtbewusst, zwischen Tradition und Moderne zerrissen',
                dream: 'Nachhaltige Stadtentwicklung, Br√ºcken zwischen Kulturen bauen'
            },
            {
                id: 'cem',
                name: 'Cem',
                age: 28,
                gender: 'm√§nnlich',
                avatar: 'üë®üèª',
                profession: 'Software-Ingenieur',
                background: 'In Deutschland aufgewachsen, kurdische Wurzeln',
                education: 'Bachelor & Master Informatik, TU M√ºnchen',
                jobOffer: 'Startup in Berlin mit F√ºhrungsposition',
                family: 'Vater (krank), Mutter, j√ºngere Schwester (BWL-Studium)',
                personality: 'Analytisch, famili√§r orientiert, sucht optimale L√∂sungen',
                dream: 'Technologie f√ºr soziale Gerechtigkeit einsetzen'
            },
            {
                id: 'aylin',
                name: 'Aylin',
                age: 25,
                gender: 'weiblich',
                avatar: 'üë©üèΩ',
                profession: 'Grafikdesignerin',
                background: 'Zweite Generation, t√ºrkisch-deutsche Identit√§t',
                education: 'Design-Studium, HfG Offenbach',
                jobOffer: 'Kreativagentur in Frankfurt, Art Director Position',
                family: 'Vater (krank), Mutter, j√ºngerer Bruder (Ausbildung)',
                personality: 'K√ºnstlerisch, empathisch, sucht nach Harmonie',
                dream: 'Kulturelle Vielfalt durch Design sichtbar machen'
            },
            {
                id: 'mehmet',
                name: 'Mehmet',
                age: 27,
                gender: 'm√§nnlich',
                avatar: 'üë®üèΩ',
                profession: 'Maschinenbauingenieur',
                background: 'In Stuttgart geboren, t√ºrkische Familie',
                education: 'Maschinenbau, Universit√§t Stuttgart',
                jobOffer: 'Automobilkonzern in M√ºnchen, Entwicklungsabteilung',
                family: 'Vater (krank), Mutter, zwei j√ºngere Br√ºder',
                personality: 'Pragmatisch, loyal, sucht praktische L√∂sungen',
                dream: 'Nachhaltige Mobilit√§t entwickeln'
            },
            {
                id: 'zeynep',
                name: 'Zeynep',
                age: 24,
                gender: 'weiblich',
                avatar: 'üë©üèª',
                profession: 'Psychologin',
                background: 'Aufgewachsen in K√∂ln, t√ºrkisch-arabische Familie',
                education: 'Master Psychologie, Universit√§t K√∂ln',
                jobOffer: 'Forschungsstelle in einer Klinik in Heidelberg',
                family: 'Vater (krank), Mutter, Bruder (Anwalt)',
                personality: 'Reflektiert, mitf√ºhlend, sucht nach tieferem Sinn',
                dream: 'Menschen mit Migrationshintergrund psychologisch unterst√ºtzen'
            }
        ];

        // Decision Options
        const options = [
            {
                id: 'family',
                icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                title: 'Familie & Tradition',
                description: 'Du √ºbernimmst das Familienrestaurant und bleibst in deiner Heimatstadt. Deine Familie kommt an erster Stelle, auch wenn du deine eigenen Tr√§ume zur√ºckstellst.'
            },
            {
                id: 'compromise',
                icon: '‚öñÔ∏è',
                title: 'Kompromiss',
                description: 'Du suchst nach einem Mittelweg: Vielleicht kannst du das Jobangebot annehmen und gleichzeitig deine Familie unterst√ºtzen (z.B. durch regelm√§√üige Besuche, finanzielle Hilfe, oder Managementberatung f√ºr das Restaurant).'
            },
            {
                id: 'career',
                icon: 'üéØ',
                title: 'Karriere & Unabh√§ngigkeit',
                description: 'Du verfolgst deine eigenen Ziele und nimmst das Jobangebot an. Die Familie muss eine andere L√∂sung finden. Du glaubst, dass du langfristig mehr f√ºr alle beitragen kannst, wenn du deine Ziele verfolgst.'
            },
            {
                id: 'delay',
                icon: '‚è∞',
                title: 'Zeit f√ºr Entscheidung',
                description: 'Du bittest um Bedenkzeit und versuchst, mehr Informationen zu sammeln. Vielleicht gibt es Alternativen, die du noch nicht gesehen hast, oder die Situation ver√§ndert sich.'
            },
            {
                id: 'community',
                icon: 'ü§ù',
                title: 'Gemeinschaftsl√∂sung',
                description: 'Du suchst nach einer kollektiven L√∂sung: Familie, Freunde und Community k√∂nnten gemeinsam das Restaurant f√ºhren, w√§hrend du deine Karriere verfolgst. Du organisierst ein Unterst√ºtzungsnetzwerk.'
            }
        ];

        // Ethical Frameworks Content
        const frameworks = {
            utilitarismus: {
                title: 'Utilitarismus',
                icon: '‚öñÔ∏è',
                content: `
                    <h4>Kernprinzip:</h4>
                    <p>Utilitarismus fragt: "Welche Handlung produziert das gr√∂√üte Gut f√ºr die gr√∂√üte Anzahl von Menschen?"</p>
                    
                    <h4>Anwendung auf deine Situation:</h4>
                    <p>Ein Utilitarist w√ºrde berechnen: Wer profitiert am meisten von deiner Entscheidung?</p>
                    <ul>
                        <li><strong>Familie √ºbernehmen:</strong> Kurzfristiges Gl√ºck der Familie, aber dein langfristiges Leiden?</li>
                        <li><strong>Karriere w√§hlen:</strong> Dein langfristiges Gl√ºck, aber kurzfristiges Leiden der Familie?</li>
                        <li><strong>Kompromiss:</strong> Vielleicht maximiert dies das Gesamtwohl f√ºr alle Beteiligten?</li>
                    </ul>
                    
                    <h4>St√§rken:</h4>
                    <p>Ber√ºcksichtigt alle Betroffenen, fokussiert auf echte Konsequenzen, nicht auf abstrakte Regeln.</p>
                    
                    <h4>Kritik:</h4>
                    <p>Schwer zu berechnen, reduziert komplexe Beziehungen auf "Nutzen", ignoriert m√∂glicherweise Rechte und Pflichten.</p>
                `
            },
            kant: {
                title: 'Deontologie (Kant)',
                icon: 'üìú',
                content: `
                    <h4>Kernprinzip:</h4>
                    <p>Kant fragt: "Kann ich wollen, dass meine Handlung ein universelles Gesetz wird?" Moralit√§t basiert auf Pflichten, nicht auf Konsequenzen.</p>
                    
                    <h4>Relevante Pflichten:</h4>
                    <ul>
                        <li><strong>Pflicht zur Familie:</strong> Dankbarkeit, F√ºrsorge f√ºr kranken Vater</li>
                        <li><strong>Pflicht zu dir selbst:</strong> Authentisch leben, deine Talente entwickeln</li>
                        <li><strong>Universalisierbarkeit:</strong> Was, wenn jeder seine Familie f√ºr Karriere aufg√§be? Gesellschaft w√ºrde zusammenbrechen. Was, wenn jeder seine Tr√§ume f√ºr Familie opferte? Innovation w√ºrde stocken.</li>
                    </ul>
                    
                    <h4>Kant w√ºrde sagen:</h4>
                    <p>Finde eine L√∂sung, die beide Pflichten respektiert. Behandle weder deine Familie noch dich selbst als blo√üe Mittel zum Zweck.</p>
                    
                    <h4>St√§rken:</h4>
                    <p>Respektiert W√ºrde aller Personen, bietet klare moralische Orientierung.</p>
                    
                    <h4>Kritik:</h4>
                    <p>Zu abstrakt, hilft nicht bei Pflichtenkonflikten, kulturell spezifisch (westlich).</p>
                `
            },
            tugend: {
                title: 'Tugendethik',
                icon: 'üéØ',
                content: `
                    <h4>Kernprinzip:</h4>
                    <p>Tugendethik fragt: "Was f√ºr eine Person willst du sein? Was w√ºrde eine tugendhafte Person in dieser Situation tun?"</p>
                    
                    <h4>Relevante Tugenden:</h4>
                    <ul>
                        <li><strong>Piet√§t:</strong> Respekt und F√ºrsorge f√ºr Eltern</li>
                        <li><strong>Mut:</strong> Zu deinen √úberzeugungen stehen</li>
                        <li><strong>Weisheit:</strong> Die richtige Balance finden</li>
                        <li><strong>Authentizit√§t:</strong> Deinem wahren Selbst treu bleiben</li>
                        <li><strong>Gro√üz√ºgigkeit:</strong> Bereit sein zu geben, wenn n√∂tig</li>
                    </ul>
                    
                    <h4>Der tugendhafte Weg:</h4>
                    <p>Eine tugendhafte Person sucht die "goldene Mitte" zwischen Extremen. Nicht r√ºcksichtsloser Egoismus (nur Karriere), nicht selbstverleugnende Opferung (nur Familie), sondern ein weiser, mutiger Kompromiss, der beiden Werten gerecht wird.</p>
                    
                    <h4>St√§rken:</h4>
                    <p>Holistisch, sch√§tzt Charakterentwicklung, kulturell resonant.</p>
                    
                    <h4>Kritik:</h4>
                    <p>Manchmal vage, was ist die "richtige" Tugend in dieser Situation?</p>
                `
            },
            kommunitarismus: {
                title: 'Kommunitarismus',
                icon: 'ü§ù',
                content: `
                    <h4>Kernprinzip:</h4>
                    <p>Kommunitarismus betont: Wir sind keine isolierten Individuen, sondern fundamental eingebettet in Gemeinschaften, Traditionen und Beziehungen, die uns pr√§gen.</p>
                    
                    <h4>Deine Identit√§t ist:</h4>
                    <ul>
                        <li><strong>Konstitutiv:</strong> Gepr√§gt durch Familie, kulturelle Traditionen, Gemeinschaft</li>
                        <li><strong>Relational:</strong> Du bist Sohn/Tochter, Geschwister, Gemeinschaftsmitglied</li>
                        <li><strong>Traditionsgebunden:</strong> Werte und Praktiken wurden dir √ºbergeben</li>
                    </ul>
                    
                    <h4>Kommunitaristische Frage:</h4>
                    <p>"Was sagen mir die Traditionen und geteilten Werte meiner Gemeinschaft √ºber die richtige Handlung?"</p>
                    
                    <p>Eine kommunitaristische L√∂sung w√ºrde Dialog suchen: Familie, erweiterte Verwandtschaft, Community zusammenbringen. Entscheidungen sollten gemeinsam getroffen werden, nicht individualistisch.</p>
                    
                    <h4>St√§rken:</h4>
                    <p>Ehrt kulturelle Identit√§t, sch√§tzt Gemeinschaft, kritisiert westlichen Individualismus.</p>
                    
                    <h4>Kritik:</h4>
                    <p>Kann unterdr√ºckend sein, kann n√∂tige Ver√§nderung blockieren, wer definiert "Gemeinschaftswerte"?</p>
                `
            }
        };

        // Initialize
        function init() {
            // Select random persona
            appState.persona = personas[Math.floor(Math.random() * personas.length)];
            
            // Display persona
            displayPersona();
            
            // Display dilemma
            displayDilemma();
            
            // Display options
            displayOptions();
            
            // Start timer
            startTimer();
        }

        function displayPersona() {
            document.getElementById('persona-avatar').textContent = appState.persona.avatar;
            document.getElementById('persona-name').textContent = appState.persona.name;
            document.getElementById('persona-profession').textContent = appState.persona.profession;

            const detailsContainer = document.getElementById('persona-details');
            detailsContainer.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">Alter & Geschlecht</div>
                    <div class="detail-value">${appState.persona.age} Jahre, ${appState.persona.gender}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Hintergrund</div>
                    <div class="detail-value">${appState.persona.background}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Ausbildung</div>
                    <div class="detail-value">${appState.persona.education}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Jobangebot</div>
                    <div class="detail-value">${appState.persona.jobOffer}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Familie</div>
                    <div class="detail-value">${appState.persona.family}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Pers√∂nlichkeit</div>
                    <div class="detail-value">${appState.persona.personality}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Traum</div>
                    <div class="detail-value">${appState.persona.dream}</div>
                </div>
            `;
        }

        function displayDilemma() {
            const dilemmaText = document.getElementById('dilemma-text');
            dilemmaText.innerHTML = `
                <p>Du hast gerade dein Studium abgeschlossen und ein <strong>Traumjobangebot</strong> erhalten: ${appState.persona.jobOffer}. Das ist genau das, wovon du immer getr√§umt hast!</p>
                
                <p style="margin-top: 15px;">Aber dann ruft dich deine Mutter an. Dein <strong>Vater ist krank</strong> geworden und kann das Familienrestaurant nicht mehr weiterf√ºhren. Seit drei Generationen ist das Restaurant der Stolz eurer Familie - ein Ort, wo eure Community zusammenkommt, wo Traditionen gelebt werden.</p>
                
                <p style="margin-top: 15px;">Deine Mutter fragt dich direkt: <em>"Kannst du nach Hause kommen und das Restaurant √ºbernehmen? Die Familie braucht dich."</em></p>
                
                <p style="margin-top: 15px;">Du stehst vor einer <strong>Zerrei√üprobe</strong>:</p>
                <ul style="margin-left: 25px; margin-top: 10px; line-height: 1.8;">
                    <li>Deine <strong>eigenen Tr√§ume</strong> und die Chance, dich beruflich zu verwirklichen</li>
                    <li>Die <strong>Erwartungen deiner Familie</strong> und die kulturelle Tradition</li>
                    <li>Die <strong>finanzielle Sicherheit</strong> deiner Familie</li>
                    <li>Deine <strong>pers√∂nliche Freiheit</strong> und Unabh√§ngigkeit</li>
                </ul>
            `;
        }

        function displayOptions() {
            const container = document.getElementById('options-container');
            options.forEach(option => {
                const card = document.createElement('div');
                card.className = 'option-card';
                card.onclick = () => selectOption(option.id);
                card.setAttribute('data-option-id', option.id);
                
                card.innerHTML = `
                    <div class="option-header">
                        <div class="option-icon">${option.icon}</div>
                        <div class="option-title">${option.title}</div>
                    </div>
                    <div class="option-description">${option.description}</div>
                `;
                
                container.appendChild(card);
            });
        }

        function selectOption(optionId) {
            // Remove previous selection
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection
            document.querySelector(`[data-option-id="${optionId}"]`).classList.add('selected');
            
            // Update state
            appState.selectedOption = optionId;
            
            // Enable submit button
            document.getElementById('submit-btn').disabled = false;
        }

        function startTimer() {
            appState.timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - appState.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        window.showFramework = function(frameworkId) {
            const framework = frameworks[frameworkId];
            const modal = document.getElementById('framework-modal');
            const modalBody = document.getElementById('modal-body');
            
            // Track click
            if (!appState.frameworksClicked.includes(frameworkId)) {
                appState.frameworksClicked.push(frameworkId);
            }
            
            // Mark button as clicked
            document.querySelectorAll('.framework-btn').forEach(btn => {
                if (btn.textContent.includes(framework.title)) {
                    btn.classList.add('clicked');
                }
            });
            
            modalBody.innerHTML = `
                <h3>${framework.icon} ${framework.title}</h3>
                <div class="modal-text">${framework.content}</div>
            `;
            
            modal.style.display = 'block';
        };

        window.closeModal = function() {
            document.getElementById('framework-modal').style.display = 'none';
        };

        window.submitDecision = async function() {
            if (!appState.selectedOption) return;
            
            const timeSpent = Math.floor((Date.now() - appState.startTime) / 1000);
            
            // Stop timer
            clearInterval(appState.timerInterval);
            
            // Prepare data
            const decisionData = {
                username: appState.user.username,
                persona: appState.persona.name,
                personaId: appState.persona.id,
                decision: appState.selectedOption,
                timeSpent: timeSpent,
                frameworksClicked: appState.frameworksClicked,
                timestamp: new Date().toISOString(),
                dilemmaId: 'migration'
            };
            
            // Save to Firebase
            try {
                await addDoc(collection(db, 'decisions'), decisionData);
                console.log('‚úÖ Decision saved');
                
                // Mark as completed
                await markDilemmaCompleted('migration');
                
                // Redirect to dashboard
                alert('‚úÖ Deine Entscheidung wurde gespeichert!\n\nZeit: ' + Math.floor(timeSpent / 60) + ' Minuten ' + (timeSpent % 60) + ' Sekunden\nFrameworks angeschaut: ' + appState.frameworksClicked.length);
                window.location.href = 'dashboard.html';
                
            } catch (error) {
                console.error('‚ùå Error saving decision:', error);
                alert('Fehler beim Speichern. Bitte versuche es erneut.');
            }
        };

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('framework-modal');
            if (event.target === modal) {
                closeModal();
            }
        };

        // Initialize app
        init();
    </script>
</body>
</html>
