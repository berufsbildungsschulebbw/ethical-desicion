<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethik-Entscheidungen: Zwischen Welten</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .intro-text {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 25px;
            margin: 30px 0;
            border-radius: 8px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .persona-card {
            background: linear-gradient(135deg, #f6f9ff 0%, #f0f3ff 100%);
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .persona-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .persona-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: white;
        }

        .persona-name {
            flex: 1;
        }

        .persona-name h2 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .persona-name .age {
            color: #666;
            font-size: 0.95em;
        }

        .persona-details {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .persona-detail {
            display: flex;
            align-items: start;
            gap: 10px;
        }

        .persona-detail-icon {
            font-size: 1.3em;
            min-width: 30px;
        }

        .ethics-intro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .ethics-intro-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .ethics-intro-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .ethics-intro-card .icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .ethics-intro-card h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .ethics-intro-card p {
            font-size: 0.9em;
            color: #666;
        }

        .scenario-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 25px;
            margin: 30px 0;
            border-radius: 8px;
        }

        .scenario-box h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .options {
            display: grid;
            gap: 15px;
            margin: 30px 0;
        }

        .option-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .option-card:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .option-card.selected {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .option-title {
            font-weight: bold;
            font-size: 1.2em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .option-description {
            color: #666;
            font-size: 0.95em;
        }

        .ethics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .ethics-button {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-align: center;
        }

        .ethics-button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .ethics-button.clicked {
            background: #e8ecff;
            border-color: #4c5fd5;
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            margin-top: 20px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.4s;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            background: none;
            border: none;
        }

        .close-modal:hover {
            color: #333;
        }

        .result-box {
            background: #f0f3ff;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .result-box h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .framework-support {
            display: grid;
            gap: 10px;
            margin: 20px 0;
        }

        .framework-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }

        .framework-item.strong {
            border-left-color: #4caf50;
        }

        .framework-item.moderate {
            border-left-color: #ff9800;
        }

        .framework-item.weak {
            border-left-color: #f44336;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 25px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .consequences {
            margin: 20px 0;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 20px;
            }
            
            header {
                padding: 30px 20px;
            }

            .persona-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Zwischen Welten</h1>
            <p class="subtitle">Ein interaktives Ethik-Dilemma zu kultureller Identit√§t</p>
        </header>

        <div class="content">
            <!-- Page 0: Start & Persona Assignment -->
            <div class="page active" id="page-start">
                <h2>Willkommen zum Ethik-Experiment</h2>
                
                <div class="intro-text">
                    <p>In diesem interaktiven Experiment werden Sie vor ein <strong>ethisches Dilemma</strong> gestellt, das Menschen mit Migrationshintergrund in westlichen Gesellschaften h√§ufig erleben.</p>
                    
                    <p style="margin-top: 15px;">Sie schl√ºpfen in die Rolle einer <strong>zuf√§llig zugewiesenen Person</strong> und treffen eine schwierige Entscheidung. Dabei k√∂nnen Sie verschiedene <strong>ethische Theorien</strong> konsultieren, um Ihre Wahl zu reflektieren.</p>
                </div>

                <div class="info-box">
                    <h3>üéØ Ziel des Projekts</h3>
                    <p>Diese Plattform erforscht, wie Menschen mit moralischen Dilemmata umgehen, bei denen es keine eindeutig "richtige" Antwort gibt. Wir analysieren:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Welche Entscheidungen in solchen Situationen getroffen werden</li>
                        <li>Welche ethischen Theorien zur Orientierung genutzt werden</li>
                        <li>Wie lange Menschen f√ºr solche Entscheidungen brauchen</li>
                    </ul>
                </div>

                <h3 style="margin-top: 30px;">üìö Die vier ethischen Modelle</h3>
                <p style="margin-bottom: 20px;">Im Verlauf k√∂nnen Sie sich √ºber diese Theorien informieren:</p>

                <div class="ethics-intro-grid">
                    <div class="ethics-intro-card">
                        <div class="icon">‚öñÔ∏è</div>
                        <h4>Utilitarismus</h4>
                        <p>Das gr√∂√üte Gl√ºck f√ºr die gr√∂√üte Zahl</p>
                    </div>
                    <div class="ethics-intro-card">
                        <div class="icon">üìú</div>
                        <h4>Deontologie</h4>
                        <p>Pflichtbasierte Ethik nach Kant</p>
                    </div>
                    <div class="ethics-intro-card">
                        <div class="icon">üíé</div>
                        <h4>Tugendethik</h4>
                        <p>Charakterbasierte Ethik nach Aristoteles</p>
                    </div>
                    <div class="ethics-intro-card">
                        <div class="icon">ü§ù</div>
                        <h4>Kommunitarismus</h4>
                        <p>Gemeinschafts- und traditionsbasierte Ethik</p>
                    </div>
                </div>

                <div class="info-box">
                    <h3>üîí Datenschutz & Anonymit√§t</h3>
                    <p>Ihre Entscheidungen werden <strong>vollst√§ndig anonymisiert</strong> gespeichert. Wir erheben keine personenbezogenen Daten (keine Namen, keine IP-Adressen, keine Email-Adressen).</p>
                    <p style="margin-top: 10px;">Gespeichert werden nur:</p>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Ihre gew√§hlte Option</li>
                        <li>Die Persona, die Ihnen zugewiesen wurde</li>
                        <li>Welche Info-Buttons Sie angeklickt haben</li>
                        <li>Wie lange Sie f√ºr die Entscheidung gebraucht haben</li>
                    </ul>
                </div>

                <button class="button" onclick="assignPersona()">Persona zuweisen & starten ‚Üí</button>
            </div>

            <!-- Page 1: Persona Introduction -->
            <div class="page" id="page-persona">
                <h2>Ihre Rolle in diesem Dilemma</h2>
                
                <p style="margin-bottom: 20px;">Sie wurden zuf√§llig dieser Person zugewiesen. Versuchen Sie, sich in ihre Situation hineinzuversetzen:</p>

                <div class="persona-card" id="persona-display">
                    <!-- Filled by JavaScript -->
                </div>

                <div class="info-box">
                    <h3>üí≠ Ihre Aufgabe</h3>
                    <p>Versuchen Sie, aus der Perspektive dieser Person zu entscheiden. Welche Werte, Hoffnungen und Verpflichtungen k√∂nnten ihre Entscheidung beeinflussen?</p>
                </div>

                <button class="button" onclick="goToPage('page-dilemma')">Zum Dilemma ‚Üí</button>
            </div>

            <!-- Page 2: Dilemma -->
            <div class="page" id="page-dilemma">
                <h2>Das Dilemma</h2>
                
                <div class="scenario-box">
                    <h3>Die Situation</h3>
                    <div id="dilemma-text">
                        <!-- Filled by JavaScript with persona-specific details -->
                    </div>
                </div>

                <h3 style="margin-top: 30px;">ü§î Ethische Perspektiven</h3>
                <p style="margin-bottom: 15px;">Bevor Sie entscheiden, k√∂nnen Sie sich √ºber verschiedene ethische Theorien informieren:</p>
                
                <div class="ethics-grid">
                    <button class="ethics-button" onclick="showEthicsModal('utilitarismus')">
                        ‚öñÔ∏è Utilitarismus
                    </button>
                    <button class="ethics-button" onclick="showEthicsModal('deontologie')">
                        üìú Deontologie
                    </button>
                    <button class="ethics-button" onclick="showEthicsModal('tugendethik')">
                        üíé Tugendethik
                    </button>
                    <button class="ethics-button" onclick="showEthicsModal('kommunitarismus')">
                        ü§ù Kommunitarismus
                    </button>
                </div>

                <h3 style="margin-top: 30px;">Ihre Entscheidung</h3>
                <p style="margin-bottom: 15px;">Was entscheidet <span class="highlight" id="persona-name-reminder"></span>?</p>

                <div class="options">
                    <div class="option-card" onclick="selectOption(1)">
                        <div class="option-title">1. Das Restaurant √ºbernehmen</div>
                        <div class="option-description">Sie sagen die Stelle ab und √ºbernehmen das Familienrestaurant. Sie opfern Ihre Karriere f√ºr die Familie und die Community.</div>
                    </div>

                    <div class="option-card" onclick="selectOption(2)">
                        <div class="option-title">2. Die Stelle annehmen</div>
                        <div class="option-description">Sie nehmen die Traumstelle an und ziehen um. Ihre Eltern m√ºssen das Restaurant verkaufen oder schlie√üen. Sie priorisieren Ihre pers√∂nliche Entfaltung.</div>
                    </div>

                    <div class="option-card" onclick="selectOption(3)">
                        <div class="option-title">3. Kompromiss: Hybridmodell</div>
                        <div class="option-description">Sie versuchen beides: Restaurant in eine GmbH umwandeln, einen Manager einstellen, selbst in Teilzeit managen und parallel in Ihrem Beruf arbeiten. Risiko: Beide Bereiche leiden.</div>
                    </div>

                    <div class="option-card" onclick="selectOption(4)">
                        <div class="option-title">4. √úbergangsphase vereinbaren</div>
                        <div class="option-description">Sie √ºbernehmen das Restaurant f√ºr 2-3 Jahre, um einen Nachfolger zu finden und die Familie zu stabilisieren. Danach wechseln Sie in Ihren Beruf. Die aktuelle Stelle ist dann wahrscheinlich weg.</div>
                    </div>

                    <div class="option-card" onclick="selectOption(5)">
                        <div class="option-title">5. Familiengespr√§ch & gemeinsame L√∂sung</div>
                        <div class="option-description">Sie initiieren ein Familiengespr√§ch mit allen Beteiligten (inkl. Schwester, erweiterte Familie), um gemeinsam nach kreativen L√∂sungen zu suchen. Die Entscheidung wird kollektiv getroffen.</div>
                    </div>
                </div>

                <button class="button" id="submit-decision" onclick="submitDecision()" disabled>Entscheidung best√§tigen ‚Üí</button>
            </div>

            <!-- Page 3: Results -->
            <div class="page" id="page-results">
                <h2>Ihre Entscheidung und ethische Perspektiven</h2>
                
                <div class="result-box" id="your-choice">
                    <!-- Filled by JavaScript -->
                </div>

                <div class="consequences" id="consequences">
                    <!-- Filled by JavaScript -->
                </div>

                <h3 style="margin-top: 30px;">Welche ethischen Theorien unterst√ºtzen Ihre Entscheidung?</h3>
                <div class="framework-support" id="framework-support">
                    <!-- Filled by JavaScript -->
                </div>

                <button class="button" onclick="goToPage('page-statistics')">Zu den Statistiken ‚Üí</button>
            </div>

            <!-- Page 4: Statistics -->
            <div class="page" id="page-statistics">
                <h2>Was haben andere entschieden?</h2>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-number" id="total-decisions">0</div>
                        <div class="stat-label">Teilnehmer*innen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avg-time">0s</div>
                        <div class="stat-label">‚åÄ Entscheidungszeit</div>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Verteilung der Entscheidungen</h3>
                <div id="decision-distribution">
                    <!-- Filled by JavaScript -->
                </div>

                <h3 style="margin-top: 30px;">Verteilung nach Personas</h3>
                <div id="persona-distribution">
                    <!-- Filled by JavaScript -->
                </div>

                <h3 style="margin-top: 30px;">Welche Info-Buttons wurden am h√§ufigsten angeklickt?</h3>
                <div id="ethics-clicks">
                    <!-- Filled by JavaScript -->
                </div>

                <button class="button" onclick="location.reload()">Neu starten</button>
            </div>
        </div>
    </div>

    <!-- Modals for Ethics Explanations -->
    <div class="modal" id="ethics-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">√ó</button>
            <div id="modal-body">
                <!-- Filled by JavaScript -->
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase Configuration (REPLACE WITH YOUR CONFIG)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase initialized");
        } catch (error) {
            console.log("Firebase not configured, running in demo mode");
        }

        // Personas
        window.personas = [
            {
                id: 'leyla',
                name: 'Leyla',
                age: 26,
                gender: 'weiblich',
                avatar: 'üë©üèª',
                profession: 'Architektin',
                background: 'Geboren in Deutschland, Eltern aus der T√ºrkei',
                education: 'Master in Architektur, Technische Universit√§t Berlin',
                jobOffer: 'Renommiertes Architekturb√ºro in Hamburg',
                family: 'Vater (krank), Mutter, j√ºngere Schwester (Medizinstudentin)',
                personality: 'Kreativ, pflichtbewusst, zwischen Tradition und Moderne zerrissen',
                dream: 'Nachhaltige Stadtentwicklung, Br√ºcken zwischen Kulturen bauen'
            },
            {
                id: 'cem',
                name: 'Cem',
                age: 28,
                gender: 'm√§nnlich',
                avatar: 'üë®üèª',
                profession: 'Software-Ingenieur',
                background: 'In Deutschland aufgewachsen, kurdische Wurzeln',
                education: 'Bachelor & Master Informatik, TU M√ºnchen',
                jobOffer: 'Startup in Berlin mit F√ºhrungsposition',
                family: 'Vater (krank), Mutter, j√ºngere Schwester (studiert BWL)',
                personality: 'Analytisch, famili√§r orientiert, sucht nach optimalen L√∂sungen',
                dream: 'Technologie f√ºr soziale Gerechtigkeit einsetzen'
            },
            {
                id: 'aylin',
                name: 'Aylin',
                age: 25,
                gender: 'weiblich',
                avatar: 'üë©üèΩ',
                profession: 'Grafikdesignerin',
                background: 'Zweite Generation, t√ºrkisch-deutsche Identit√§t',
                education: 'Design-Studium, Hochschule f√ºr Gestaltung Offenbach',
                jobOffer: 'Kreativagentur in Frankfurt, Art Director Position',
                family: 'Vater (krank), Mutter, j√ºngerer Bruder (Ausbildung)',
                personality: 'K√ºnstlerisch, empathisch, sucht nach Harmonie',
                dream: 'Kulturelle Vielfalt durch Design sichtbar machen'
            },
            {
                id: 'mehmet',
                name: 'Mehmet',
                age: 27,
                gender: 'm√§nnlich',
                avatar: 'üë®üèΩ',
                profession: 'Maschinenbauingenieur',
                background: 'In Stuttgart geboren, t√ºrkische Familie',
                education: 'Maschinenbau, Universit√§t Stuttgart',
                jobOffer: 'Automobilkonzern in M√ºnchen, Entwicklungsabteilung',
                family: 'Vater (krank), Mutter, j√ºngere Schwester (Lehramt-Studium)',
                personality: 'Praktisch veranlagt, loyal, pragmatischer Probleml√∂ser',
                dream: 'Elektromobilit√§t voranbringen, Br√ºcke zwischen Generationen'
            },
            {
                id: 'zeynep',
                name: 'Zeynep',
                age: 26,
                gender: 'weiblich',
                avatar: 'üë©üèΩ‚Äçü¶±',
                profession: 'Psychologin',
                background: 'In K√∂ln aufgewachsen, t√ºrkisch-arabische Wurzeln',
                education: 'Psychologie, Universit√§t K√∂ln',
                jobOffer: 'Klinik in D√ºsseldorf, Traumatherapie-Spezialisierung',
                family: 'Vater (krank), Mutter, √§lterer Bruder (arbeitet im Restaurant)',
                personality: 'Reflektiert, einf√ºhlsam, ringt mit eigenen Erwartungen',
                dream: 'Menschen mit Migrationserfahrung psychologisch unterst√ºtzen'
            }
        ];

        // Global state
        window.appState = {
            persona: null,
            selectedOption: null,
            startTime: Date.now(),
            decisionTime: null,
            ethicsButtonsClicked: [],
            sessionId: 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
        };

        // Assign random persona
        window.assignPersona = function() {
            const randomIndex = Math.floor(Math.random() * window.personas.length);
            window.appState.persona = window.personas[randomIndex];
            
            displayPersona();
            goToPage('page-persona');
        };

        // Display persona
        window.displayPersona = function() {
            const persona = window.appState.persona;
            const personaDisplay = document.getElementById('persona-display');
            
            personaDisplay.innerHTML = `
                <div class="persona-header">
                    <div class="persona-avatar">${persona.avatar}</div>
                    <div class="persona-name">
                        <h2>${persona.name}</h2>
                        <div class="age">${persona.age} Jahre, ${persona.gender}</div>
                    </div>
                </div>
                
                <div class="persona-details">
                    <div class="persona-detail">
                        <div class="persona-detail-icon">üíº</div>
                        <div><strong>Beruf:</strong> ${persona.profession}</div>
                    </div>
                    <div class="persona-detail">
                        <div class="persona-detail-icon">üéì</div>
                        <div><strong>Ausbildung:</strong> ${persona.education}</div>
                    </div>
                    <div class="persona-detail">
                        <div class="persona-detail-icon">üåç</div>
                        <div><strong>Hintergrund:</strong> ${persona.background}</div>
                    </div>
                    <div class="persona-detail">
                        <div class="persona-detail-icon">üë®‚Äçüë©‚Äçüëß</div>
                        <div><strong>Familie:</strong> ${persona.family}</div>
                    </div>
                    <div class="persona-detail">
                        <div class="persona-detail-icon">‚ú®</div>
                        <div><strong>Angebot:</strong> ${persona.jobOffer}</div>
                    </div>
                    <div class="persona-detail">
                        <div class="persona-detail-icon">üí≠</div>
                        <div><strong>Charakter:</strong> ${persona.personality}</div>
                    </div>
                    <div class="persona-detail">
                        <div class="persona-detail-icon">üéØ</div>
                        <div><strong>Traum:</strong> ${persona.dream}</div>
                    </div>
                </div>
            `;

            // Update dilemma text with persona
            const dilemmaText = document.getElementById('dilemma-text');
            dilemmaText.innerHTML = `
                <p>Sie sind <strong>${persona.name}</strong>, ${persona.age} Jahre alt, in Deutschland geboren und aufgewachsen. Ihre Eltern haben mit harter Arbeit ein erfolgreiches Restaurant aufgebaut. Das Restaurant ist mehr als nur ein Gesch√§ft ‚Äì es ist zum Treffpunkt f√ºr die Community geworden, ein St√ºck Heimat in der Fremde.</p>
                
                <p style="margin-top: 15px;">Sie haben gerade Ihr Studium (${persona.profession}) mit Auszeichnung abgeschlossen. ${persona.jobOffer} hat Ihnen eine Stelle angeboten ‚Äì Ihre Traumposition. Gleichzeitig ist Ihr Vater krank geworden. Die √Ñrzte sagen, er muss k√ºrzertreten.</p>
                
                <p style="margin-top: 15px;">Ihre Eltern erwarten, dass Sie das Restaurant √ºbernehmen. "Das haben wir alles f√ºr euch aufgebaut", sagt Ihre Mutter. "Das ist nicht nur unser Gesch√§ft ‚Äì das ist unser Erbe, unsere Identit√§t, unsere Community."</p>
                
                <p style="margin-top: 15px;">Ihre Geschwister k√∂nnen nicht einspringen. Wenn Sie ablehnen, m√ºssen Ihre Eltern das Restaurant wahrscheinlich verkaufen oder schlie√üen. Die Community w√ºrde einen wichtigen Ort verlieren. Ihre Familie w√§re tief entt√§uscht.</p>
                
                <p style="margin-top: 15px;"><strong>Was entscheiden Sie?</strong></p>
            `;

            // Update persona name reminder
            document.getElementById('persona-name-reminder').textContent = persona.name;
        };

        // Ethics content
        window.ethicsContent = {
            utilitarismus: {
                title: "Utilitarismus: Das gr√∂√üte Gl√ºck f√ºr die gr√∂√üte Zahl",
                content: `
                    <h3>Kernprinzip</h3>
                    <p>Der Utilitarismus (begr√ºndet von Jeremy Bentham und John Stuart Mill) beurteilt Handlungen nach ihren Konsequenzen: Eine Handlung ist richtig, wenn sie das gr√∂√üte Gl√ºck bzw. Wohlergehen f√ºr die gr√∂√üte Anzahl von Menschen erzeugt.</p>
                    
                    <h3>Anwendung auf das Dilemma</h3>
                    <p>Ein Utilitarist w√ºrde berechnen:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Ihr pers√∂nliches Gl√ºck:</strong> Erf√ºllung durch eigenen Beruf vs. Frustration im Restaurant</li>
                        <li><strong>Familie:</strong> Eltern gl√ºcklich/ungl√ºcklich, Geschwister entlastet/belastet</li>
                        <li><strong>Community:</strong> 50+ Personen verlieren einen wichtigen sozialen Ort</li>
                        <li><strong>Gesellschaft:</strong> Diversit√§t in der Arbeitswelt, wirtschaftlicher Beitrag</li>
                    </ul>
                    
                    <h3>Wahrscheinliche Entscheidung</h3>
                    <p><strong>Option 3 (Hybrid)</strong> oder <strong>Option 5 (Familiengespr√§ch)</strong> ‚Äì versuchen, das Gesamtgl√ºck zu maximieren durch kreative L√∂sungen.</p>
                    
                    <h3>St√§rken</h3>
                    <p>Ber√ºcksichtigt alle Betroffenen; pragmatisch; zukunftsorientiert</p>
                    
                    <h3>Schw√§chen</h3>
                    <p>Schwer zu berechnen; kann individuelle Rechte verletzen; ignoriert m√∂glicherweise kulturelle Pflichten, die nicht in "Gl√ºck" messbar sind</p>
                `
            },
            deontologie: {
                title: "Deontologie: Pflicht und moralische Regeln",
                content: `
                    <h3>Kernprinzip</h3>
                    <p>Die Deontologie (Immanuel Kant) beurteilt Handlungen nicht nach Konsequenzen, sondern danach, ob sie moralischen Pflichten und Prinzipien folgen. Der "kategorische Imperativ" besagt: Handle nur nach Maximen, die du als allgemeines Gesetz wollen k√∂nntest.</p>
                    
                    <h3>Anwendung auf das Dilemma</h3>
                    <p>Ein Deontologe w√ºrde relevante Pflichten identifizieren:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Pflicht gegen√ºber den Eltern:</strong> Dankbarkeit, F√ºrsorge f√ºr kranken Vater</li>
                        <li><strong>Pflicht gegen√ºber sich selbst:</strong> Recht auf Selbstverwirklichung, eigene Talente nutzen</li>
                        <li><strong>Pflicht der Wahrhaftigkeit:</strong> Authentisch zu eigenen Werten stehen</li>
                        <li><strong>Universalisierbarkeit:</strong> Kann ich wollen, dass alle Menschen ihre Tr√§ume f√ºr Familienbetriebe aufgeben?</li>
                    </ul>
                    
                    <h3>Wahrscheinliche Entscheidung</h3>
                    <p><strong>Option 5 (Familiengespr√§ch)</strong> ‚Äì respektiert alle Rechte; oder <strong>Option 2 (Stelle annehmen)</strong> ‚Äì Recht auf Selbstbestimmung</p>
                    
                    <h3>St√§rken</h3>
                    <p>Respektiert individuelle Rechte; verhindert Instrumentalisierung von Personen; bietet klare Orientierung</p>
                    
                    <h3>Schw√§chen</h3>
                    <p>Pflichtenkonflikte schwer aufzul√∂sen; kann zu starr sein; ignoriert Konsequenzen komplett</p>
                `
            },
            tugendethik: {
                title: "Tugendethik: Was w√ºrde ein guter Mensch tun?",
                content: `
                    <h3>Kernprinzip</h3>
                    <p>Die Tugendethik (Aristoteles) fragt nicht nach Regeln oder Konsequenzen, sondern: "Was f√ºr ein Mensch will ich sein?" Sie fokussiert auf die Entwicklung eines guten Charakters und tugendhafter Eigenschaften wie Weisheit, Mut, Gerechtigkeit und M√§√üigung.</p>
                    
                    <h3>Anwendung auf das Dilemma</h3>
                    <p>Ein Tugendethiker w√ºrde fragen: Welche Charaktereigenschaften zeigen sich in den verschiedenen Entscheidungen?</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Dankbarkeit:</strong> Erkenntnis dessen, was Eltern geleistet haben</li>
                        <li><strong>Mut:</strong> F√ºr eigene √úberzeugungen einstehen, auch gegen Widerstand</li>
                        <li><strong>Praktische Weisheit:</strong> Die richtige Balance im Kontext finden</li>
                        <li><strong>Loyalit√§t vs. Authentizit√§t:</strong> Beiden gerecht werden</li>
                        <li><strong>Gro√üz√ºgigkeit:</strong> Eigene Ressourcen (Zeit, Talent) teilen</li>
                    </ul>
                    
                    <h3>Wahrscheinliche Entscheidung</h3>
                    <p><strong>Option 4 (√úbergangsphase)</strong> oder <strong>Option 3 (Hybrid)</strong> ‚Äì zeigt praktische Weisheit, Balance verschiedener Tugenden</p>
                    
                    <h3>St√§rken</h3>
                    <p>Holistisch; ber√ºcksichtigt langfristigen Charakter; kulturell anpassbar; betont Kontext</p>
                    
                    <h3>Schw√§chen</h3>
                    <p>Manchmal vage; "Was ist tugendhaft?" ist kulturabh√§ngig; bietet keine klaren Entscheidungsregeln</p>
                `
            },
            kommunitarismus: {
                title: "Kommunitarismus: Gemeinschaft und kulturelle Identit√§t",
                content: `
                    <h3>Kernprinzip</h3>
                    <p>Der Kommunitarismus (MacIntyre, Sandel, Taylor) betont, dass Individuen fundamental durch ihre Gemeinschaften, Traditionen und sozialen Beziehungen gepr√§gt sind. Unsere Identit√§t und moralischen Verpflichtungen entstehen aus unserer Einbettung in bestimmte Gemeinschaften, nicht aus abstrakten universellen Prinzipien.</p>
                    
                    <h3>Anwendung auf das Dilemma</h3>
                    <p>Ein Kommunitarist w√ºrde analysieren:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Konstitutive Identit√§t:</strong> Wer sind Sie? Die Identit√§t ist untrennbar verbunden mit Familie, Community, aber auch deutscher Bildung</li>
                        <li><strong>Gemeinschaftliche G√ºter:</strong> Das Restaurant ist nicht nur Eigentum, sondern ein gemeinsames kulturelles Gut der Community</li>
                        <li><strong>Narrative Kontinuit√§t:</strong> Die Entscheidung verbindet Vergangenheit (Eltern), Gegenwart (Sie) und Zukunft (n√§chste Generation)</li>
                        <li><strong>Mehrfache Zugeh√∂rigkeiten:</strong> Sie geh√∂ren zu mehreren Communities ‚Äì welche definiert Sie am meisten?</li>
                    </ul>
                    
                    <h3>Wahrscheinliche Entscheidung</h3>
                    <p><strong>Option 1 (Restaurant √ºbernehmen)</strong> oder <strong>Option 5 (Familiengespr√§ch)</strong> ‚Äì respektiert Gemeinschaftsbindungen und kollektive Entscheidung</p>
                    
                    <h3>St√§rken</h3>
                    <p>Erkennt Wichtigkeit von Kultur und Zugeh√∂rigkeit; respektiert kollektive Identit√§t; betont Beziehungen statt Individualismus</p>
                    
                    <h3>Schw√§chen</h3>
                    <p>Kann konservativ sein; unterdr√ºckende Traditionen; begrenzt individuelle Freiheit; Konflikt zwischen verschiedenen Gemeinschaften</p>
                `
            }
        };

        // Option details
        window.optionDetails = {
            1: {
                title: "Das Restaurant √ºbernehmen",
                consequences: "Sie geben Ihre Karriere auf. Kurzfristig sind Ihre Eltern erleichtert und die Community beh√§lt ihren Treffpunkt. Langfristig k√∂nnten Sie Ihre Entscheidung bereuen. Es besteht die Gefahr von Frustration und dem Gef√ºhl, Ihr Potenzial nicht ausgesch√∂pft zu haben. Andererseits k√∂nnten Sie Erf√ºllung in der F√ºhrung eines Familienunternehmens und der Bewahrung kultureller Werte finden.",
                frameworks: {
                    utilitarismus: "moderate",
                    deontologie: "strong",
                    tugendethik: "moderate",
                    kommunitarismus: "strong"
                }
            },
            2: {
                title: "Die Stelle annehmen",
                consequences: "Sie verwirklichen Ihren Traum und bauen Ihre Karriere auf. Ihre Familie ist tief entt√§uscht, m√∂glicherweise kommt es zum Bruch. Das Restaurant wird verkauft, die Community verliert ihren Treffpunkt. Sie tragen die psychische Last dieser Entscheidung, k√∂nnten aber langfristig beruflich erfolgreich und selbstverwirklicht sein.",
                frameworks: {
                    utilitarismus: "weak",
                    deontologie: "moderate",
                    tugendethik: "weak",
                    kommunitarismus: "weak"
                }
            },
            3: {
                title: "Kompromiss: Hybridmodell",
                consequences: "Sie versuchen beides zu vereinbaren ‚Äì ein ambitionierter Ansatz. Risiko: Sie sind √ºberfordert, beide Bereiche leiden unter mangelnder Aufmerksamkeit. Das Restaurant l√§uft nicht optimal, Ihre Karriere entwickelt sich langsamer. Vorteil: Sie behalten beide Optionen offen und demonstrieren Flexibilit√§t.",
                frameworks: {
                    utilitarismus: "strong",
                    deontologie: "moderate",
                    tugendethik: "strong",
                    kommunitarismus: "moderate"
                }
            },
            4: {
                title: "√úbergangsphase vereinbaren",
                consequences: "Sie zeigen Verantwortung und Loyalit√§t, indem Sie eine befristete Unterst√ºtzung anbieten. Dies gibt Ihrer Familie Zeit, sich anzupassen und Alternativen zu finden. Die aktuelle Traumstelle ist wahrscheinlich weg, aber andere M√∂glichkeiten werden sich ergeben. Sie opfern 2-3 Jahre, gewinnen aber die M√∂glichkeit, ohne massive Schuldgef√ºhle Ihren Weg zu gehen.",
                frameworks: {
                    utilitarismus: "strong",
                    deontologie: "strong",
                    tugendethik: "strong",
                    kommunitarismus: "moderate"
                }
            },
            5: {
                title: "Familiengespr√§ch & gemeinsame L√∂sung",
                consequences: "Sie demokratisieren die Entscheidung und beziehen alle Betroffenen ein. Dies kann zu kreativen L√∂sungen f√ºhren, die niemand allein bedacht h√§tte. Die Entscheidung wird getragen von allen, nicht nur von Ihnen. Risiko: Das Gespr√§ch k√∂nnte konfliktreich sein, und die L√∂sung k√∂nnte Kompromisse erfordern, die niemanden vollst√§ndig zufriedenstellen.",
                frameworks: {
                    utilitarismus: "moderate",
                    deontologie: "strong",
                    tugendethik: "strong",
                    kommunitarismus: "strong"
                }
            }
        };

        // Framework info
        window.frameworkInfo = {
            utilitarismus: { name: "Utilitarismus", icon: "‚öñÔ∏è" },
            deontologie: { name: "Deontologie", icon: "üìú" },
            tugendethik: { name: "Tugendethik", icon: "üíé" },
            kommunitarismus: { name: "Kommunitarismus", icon: "ü§ù" }
        };

        window.supportLevels = {
            strong: { text: "Stark unterst√ºtzt", color: "#4caf50" },
            moderate: { text: "Moderat unterst√ºtzt", color: "#ff9800" },
            weak: { text: "Schwach unterst√ºtzt", color: "#f44336" }
        };

        // Navigation
        window.goToPage = function(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        };

        // Option selection
        window.selectOption = function(optionNum) {
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            window.appState.selectedOption = optionNum;
            document.getElementById('submit-decision').disabled = false;
        };

        // Show ethics modal
        window.showEthicsModal = function(ethicsType) {
            const modal = document.getElementById('ethics-modal');
            const modalBody = document.getElementById('modal-body');
            const content = window.ethicsContent[ethicsType];
            
            modalBody.innerHTML = `
                <h2>${content.title}</h2>
                ${content.content}
            `;
            
            modal.classList.add('active');
            
            if (!window.appState.ethicsButtonsClicked.includes(ethicsType)) {
                window.appState.ethicsButtonsClicked.push(ethicsType);
            }
            
            event.currentTarget.classList.add('clicked');
        };

        window.closeModal = function() {
            document.getElementById('ethics-modal').classList.remove('active');
        };

        // Submit decision
        window.submitDecision = async function() {
            if (!window.appState.selectedOption) return;
            
            window.appState.decisionTime = Date.now() - window.appState.startTime;
            
            if (db) {
                try {
                    await addDoc(collection(db, "decisions"), {
                        sessionId: window.appState.sessionId,
                        personaId: window.appState.persona.id,
                        personaName: window.appState.persona.name,
                        selectedOption: window.appState.selectedOption,
                        decisionTime: window.appState.decisionTime,
                        ethicsButtonsClicked: window.appState.ethicsButtonsClicked,
                        timestamp: new Date().toISOString()
                    });
                    console.log("Decision saved to Firebase");
                } catch (error) {
                    console.error("Error saving to Firebase:", error);
                }
            }
            
            showResults();
            goToPage('page-results');
        };

        // Show results
        window.showResults = function() {
            const option = window.appState.selectedOption;
            const details = window.optionDetails[option];
            const persona = window.appState.persona;
            
            document.getElementById('your-choice').innerHTML = `
                <h3>${persona.name} hat gew√§hlt:</h3>
                <p style="font-size: 1.2em; font-weight: bold; color: #667eea; margin-top: 10px;">
                    ${details.title}
                </p>
            `;
            
            document.getElementById('consequences').innerHTML = `
                <h3>‚ö†Ô∏è M√∂gliche Konsequenzen</h3>
                <p style="margin-top: 10px;">${details.consequences}</p>
            `;
            
            let frameworkHTML = '';
            for (const [framework, support] of Object.entries(details.frameworks)) {
                const info = window.frameworkInfo[framework];
                const supportInfo = window.supportLevels[support];
                
                frameworkHTML += `
                    <div class="framework-item ${support}">
                        <strong>${info.icon} ${info.name}:</strong> 
                        <span style="color: ${supportInfo.color}">${supportInfo.text}</span>
                    </div>
                `;
            }
            document.getElementById('framework-support').innerHTML = frameworkHTML;
        };

        // Load statistics
        window.loadStatistics = async function() {
            if (!db) {
                showDemoStatistics();
                return;
            }
            
            try {
                const decisionsRef = collection(db, "decisions");
                const q = query(decisionsRef, orderBy("timestamp", "desc"), limit(100));
                const querySnapshot = await getDocs(q);
                
                const decisions = [];
                querySnapshot.forEach((doc) => {
                    decisions.push(doc.data());
                });
                
                displayStatistics(decisions);
            } catch (error) {
                console.error("Error loading statistics:", error);
                showDemoStatistics();
            }
        };

        // Display statistics
        window.displayStatistics = function(decisions) {
            document.getElementById('total-decisions').textContent = decisions.length;
            
            const avgTime = decisions.reduce((sum, d) => sum + d.decisionTime, 0) / decisions.length;
            document.getElementById('avg-time').textContent = Math.round(avgTime / 1000) + 's';
            
            // Decision distribution
            const optionCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0};
            decisions.forEach(d => {
                optionCounts[d.selectedOption]++;
            });
            
            let distributionHTML = '';
            for (let i = 1; i <= 5; i++) {
                const count = optionCounts[i];
                const percentage = (count / decisions.length * 100).toFixed(1);
                distributionHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span><strong>Option ${i}:</strong> ${window.optionDetails[i].title}</span>
                            <span>${count} (${percentage}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%">${percentage}%</div>
                        </div>
                    </div>
                `;
            }
            document.getElementById('decision-distribution').innerHTML = distributionHTML;

            // Persona distribution
            const personaCounts = {};
            decisions.forEach(d => {
                if (d.personaId) {
                    personaCounts[d.personaName] = (personaCounts[d.personaName] || 0) + 1;
                }
            });

            let personaHTML = '';
            for (const [personaName, count] of Object.entries(personaCounts)) {
                const percentage = (count / decisions.length * 100).toFixed(1);
                personaHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span><strong>${personaName}</strong></span>
                            <span>${count} (${percentage}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%">${percentage}%</div>
                        </div>
                    </div>
                `;
            }
            document.getElementById('persona-distribution').innerHTML = personaHTML || '<p style="color: #999;">Noch keine Persona-Daten verf√ºgbar</p>';
            
            // Ethics clicks
            const ethicsClicks = {
                utilitarismus: 0,
                deontologie: 0,
                tugendethik: 0,
                kommunitarismus: 0
            };
            
            decisions.forEach(d => {
                d.ethicsButtonsClicked.forEach(ethics => {
                    ethicsClicks[ethics]++;
                });
            });
            
            let ethicsHTML = '';
            for (const [ethics, count] of Object.entries(ethicsClicks)) {
                const info = window.frameworkInfo[ethics];
                const percentage = (count / decisions.length * 100).toFixed(1);
                ethicsHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span><strong>${info.icon} ${info.name}</strong></span>
                            <span>${count} mal (${percentage}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%">${percentage}%</div>
                        </div>
                    </div>
                `;
            }
            document.getElementById('ethics-clicks').innerHTML = ethicsHTML;
        };

        // Demo statistics
        window.showDemoStatistics = function() {
            document.getElementById('total-decisions').textContent = '0';
            document.getElementById('avg-time').textContent = '0s';
            
            document.getElementById('decision-distribution').innerHTML = `
                <p style="color: #999; text-align: center; padding: 20px;">
                    Firebase nicht konfiguriert. Demo-Modus aktiv.<br>
                    Konfigurieren Sie Firebase, um echte Statistiken zu sehen.
                </p>
            `;
            
            document.getElementById('persona-distribution').innerHTML = `
                <p style="color: #999; text-align: center; padding: 20px;">
                    Statistiken verf√ºgbar nach Firebase-Konfiguration.
                </p>
            `;
            
            document.getElementById('ethics-clicks').innerHTML = `
                <p style="color: #999; text-align: center; padding: 20px;">
                    Statistiken verf√ºgbar nach Firebase-Konfiguration.
                </p>
            `;
        };

        // Load statistics when navigating to statistics page
        const originalGoToPage = window.goToPage;
        window.goToPage = function(pageId) {
            originalGoToPage(pageId);
            if (pageId === 'page-statistics') {
                loadStatistics();
            }
        };

        // Close modal on background click
        document.getElementById('ethics-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
